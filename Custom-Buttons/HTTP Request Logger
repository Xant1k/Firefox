custombutton: //<?xml version="1.0" encoding="UTF-8"?>
    <
    custombutton xmlns: cb = "http://xsms.nm.ru/custombuttons/" >
    <
    name > Unnamed < /name> <
    image > < ![CDATA[data: image / x - icon; base64, AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / AAAA / wAAAP / AwMD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / wMDA / wAAAP8AAAD / wMDA / wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA / 8 DAwP8AAAD / AAAA / 8 DAwP8AAAD / AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP / AwMD / AAAA / wAAAP / AwMD / AAAA / wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD / wMDA / wAAAP8AAAD / wMDA / wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA / 8 DAwP8AAAD / AAAA / 8 DAwP8AAAD / AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP / AwMD / AAAA / wAAAP / AwMD / AAAA / wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD / wMDA / wAAAP8AAAD / wMDA / wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA / 8 DAwP8AAAD / AAAA / 8 DAwP8AAAD / AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP / AwMD / AAAA / wAAAP / AwMD / AAAA / wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD / wMDA / wAAAP8AAAD / wMDA / wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA / 8 DAwP8AAAD / AAAA / 8 DAwP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP / AwMD / AAAA / wAAAP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / 8 DAwP / AwMD / wMDA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AAAA / wAAAP8AAAD / AACsQQAArEEAAKxBH / isQR / 4 rEEf + KxBH / isQR / 4 rEEf + KxBH / isQR / 4 rEEf + KxBH / isQQAArEEAAKxBAACsQQ == ]] > < /image> <
    mode > 0 < /mode> <
    initcode > < ![CDATA[gBrowser.currentURI.spec == "about:customizing" || (() => {
        var fileName = "http-request-log.txt";
        var file = Services.dirsvc.get("Desk", Ci.nsIFile);
        file.append(fileName);

        var obsId = "httpRequestLogger";
        var pn = "CB." + obsId + ".on";
        cbu.isPref(pn, false);
        var pref = Application.prefs.get(pn);

        function obsConstructor() {
            var obs = Application.storage.get(obsId, null);
            if (!obs) {
                obs = {
                    topic: "http-on-modify-request",
                    init: function() Services.obs.addObserver(this, this.topic, false),
                    destroy: function() {
                        try {
                            Services.obs.removeObserver(this, this.topic);
                        } catch (ex) {
                            Cu.reportError(ex);
                        }
                    },
                    observe: function(subj) {
                        var channel = subj.QueryInterface(Ci.nsIHttpChannel);
                        var ref = channel.referrer ? channel.referrer.spec : "(none)";
                        var str = ref + " " + channel.requestMethod + " " + channel.URI.spec + "\r\n";
                        str = this.suc.ConvertFromUnicode(str);
                        this.fos.write(str, str.length);
                    },
                    get fos() {
                        delete this.fos;
                        var fos = Cc["@mozilla.org/network/file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);
                        // PR_WRONLY | PR_CREATE_FILE | PR_APPEND
                        fos.init(file, parseInt("0x02") | parseInt("0x08") | parseInt("0x10"), -1, 0);
                        return this.fos = fos;
                    },
                    get suc() {
                        delete this.suc;
                        var suc = Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);
                        suc.charset = "utf-8";
                        return this.suc = suc;
                    }

                };
                Application.storage.set(obsId, obs);
                obs.init();
            }
        }

        function obsDestructor(reason) {
            if (!"update delete".contains(reason)) return;
            var obs = Application.storage.get(obsId, null);
            if (obs) {
                obs.destroy();
                Application.storage.set(obsId, null);
            }
            reason == "delete" && pref.reset();
        }
        addDestructor(reason => {
            obsDestructor(reason);
            setTimeout(function() {
                custombuttons.palette.querySelector('toolbarbutton[id="' + _id + '"]') && obsDestructor("delete");
            }, 500);
        });

        var imgON = "data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/AAAA/wAAAP/AwMD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/wMDA/wAAAP8AAAD/wMDA/wAAAP9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/AAAA/8DAwP8AAAD/AAAA/8DAwP8AAAD/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/wAAAP/AwMD/AAAA/wAAAP/AwMD/AAAA/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf8AAAD/wMDA/wAAAP8AAAD/wMDA/wAAAP9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/AAAA/8DAwP8AAAD/AAAA/8DAwP8AAAD/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/wAAAP/AwMD/AAAA/wAAAP/AwMD/AAAA/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf8AAAD/wMDA/wAAAP8AAAD/wMDA/wAAAP9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/AAAA/8DAwP8AAAD/AAAA/8DAwP8AAAD/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/wAAAP/AwMD/AAAA/wAAAP/AwMD/AAAA/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf8AAAD/wMDA/wAAAP8AAAD/wMDA/wAAAP9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/Zv+Z/2b/mf9m/5n/AAAA/8DAwP8AAAD/AAAA/8DAwP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP/AwMD/AAAA/wAAAP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/8DAwP/AwMD/wMDA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AACsQQAArEEAAKxBAACsQQAArEEAAKxBAACsQQAArEEAAKxBAACsQQAArEEAAKxBAACsQQAArEEAAKxBAACsQQ==";

        function setState(on) {
            on ? obsConstructor() : obsDestructor("delete");
            pref.value = on;
            var src = on ? imgON : self.image;
            var en = Services.wm.getEnumerator("navigator:browser");
            while (en.hasMoreElements()) {
                var doc = en.getNext().document;
                var btn = doc.getElementById(_id);
                var [img] = doc.getAnonymousNodes(btn);
                if (img) img.src = src;
            }
        }
        setState(pref.value);
        self.onclick = e => {
            if (!e.button) setState(!pref.value);
            else if (e.button == 1) file.exists() && file.launch();
        }
    })();]] > < /initcode> <
    code > < ![CDATA[ /*CODE*/ ]] > < /code> <
    accelkey > < ![CDATA[]] > < /accelkey> <
    help > < ![CDATA[]] > < /help> <
    attributes / >
    <
    /custombutton>
